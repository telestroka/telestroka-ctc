<?php
/***********************************************
-=Ms Site=-

Автор:    Миропольский Михаил <ms@ensk.ru>
Описание: Класс расширенной отправки почты
***********************************************/

require_once('mime.class');

class Xmail
{
	function XmailXmailer($names, $emails, $subject, $text, $html, $images, $files, $from, $fromName)
	{
		$mail = new html_mime_mail('X-Mailer: Html Mime Mail Class');

		$subject = convert_cyr_string($subject, 'w', 'k');
		$text = convert_cyr_string($text, 'w', 'k');
		$html = convert_cyr_string($html, 'w', 'k');
		$fromName = convert_cyr_string($fromName, 'w', 'k');

		//load images
		if ( is_array($images) )
		{
			foreach ($images as $key => $image_info)
			{
				$mail->add_html_image($image_info['content'], $image_info['name'], $image_info['type']);
			}
		}

		//load files
		if ( is_array($files) )
		{
			foreach ($files as $key => $file_info)
			{
				$mail->add_attachment($file_info['content'], $file_info['name'], $file_info['type']);
			}
		}

	    $mail->add_html($html, $text);
	    $mail->set_charset('KOI8-R', TRUE);
	    $mail->build_message();

		if ( !is_array($emails) || !is_array($names) ) return FALSE;

		foreach ($emails as $key => $email)
		{
			if ( strlen($email) < 6 ) continue;
	      	{
				$mail->send($names[$key], $email, $fromName, $from, $subject);
			}

		}
	}
}
?>