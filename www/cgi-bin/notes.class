<?php
/***********************************************
-=Ms Site=-

Модуль: Notes
Автор: Миропольский Михаил <ms@ensk.ru>
Описание: Класс комментируемых статей
***********************************************/
require_once('utils/sql.class');

class Notes extends Sql
{
	//конструктор
	function Notes()
	{
		$this->SqlConnect();

		$this->sqlQuery = 'CREATE TABLE IF NOT EXISTS notes_items (
																	id int(11) NOT NULL auto_increment,
																	text text NOT NULL,
																	cat varchar(255) NOT NULL default "",
																	name varchar(255) NOT NULL default "",
																	email varchar(255) NOT NULL default "",
																	user varchar(255) NOT NULL default "",
																	ip varchar(15) NOT NULL default "",
																	date date NOT NULL default "0000-00-00",
																	PRIMARY KEY id (id)
																	) TYPE=MyISAM;';
		$this->SqlExecute();

		$this->sqlQuery = 'CREATE TABLE IF NOT EXISTS notes_cats (
																	id int(11) NOT NULL auto_increment,
																	title varchar(255) NOT NULL default "",
																	text text NOT NULL, 
																	image varchar(255) NOT NULL default "",
																	name varchar(255) NOT NULL default "",
																	url varchar(255) NOT NULL default "",
																	email varchar(255) NOT NULL default "",
																	date date NOT NULL default "0000-00-00",
																	tags text NOT NULL, 
																	PRIMARY KEY id (id)
																	) TYPE=MyISAM;';
		$this->SqlExecute();
		
		return TRUE;
	}
	
	function NotesGetTagCats($notes_tag)
	{
		$notes_tag = $this->SqlPrepare($notes_tag);
		$cats_info = array();
		$this->sqlQuery = 'select id from notes_cats where tags like "%' . $notes_tag . '%" and tags like "%СТС%" order by id desc';
		$this->SqlExecute();
        while ($row = mysql_fetch_array($this->sqlRes))
        {
            $cats_info[$row['id']] = $row;
        }
		return $cats_info;
	}
	
	function NotesGetYearCats($year)
	{
		$year = $this->SqlPrepare($year);
		$cats_info = array();
		$this->sqlQuery = 'select id from notes_cats where date like "' . $year . '%" and tags like "%СТС%" order by id desc';
		$this->SqlExecute();
        while ($row = mysql_fetch_array($this->sqlRes))
        {
            $cats_info[$row['id']] = $row;
        }
		return $cats_info;
	}
	
	function NotesGetCats()
	{
		$table_info = array();
		$this->sqlQuery = 'select * from notes_cats where tags like "%СТС%" order by date desc';
		$this->SqlExecute();
        while ($row = mysql_fetch_array($this->sqlRes))
        {
            $table_info[$row['id']] = $row;
        }
		return $table_info;
	}
}
?>